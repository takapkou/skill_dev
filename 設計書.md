# 技術別作業時間入力アプリ - 設計書

## 1. システム概要

### 1.1 目的
日々の技術学習・開発作業の時間を簡単に記録し、CSV形式でエクスポートするWebアプリケーション

### 1.2 技術スタック
- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla JS)
- **データ保存**: localStorage (ブラウザ内蔵)
- **ファイル出力**: Blob API + File Download
- **デプロイ**: 静的ファイル（ローカル実行可能）

## 2. アーキテクチャ設計

### 2.1 ファイル構成
```
技術別作業時間 入力/
├── index.html          # メインHTML
├── styles.css          # スタイルシート
├── js/
│   ├── config.js       # 設定管理（技術分野）
│   ├── storage.js      # localStorageラッパー
│   ├── dataManager.js  # データCRUD操作
│   ├── csvExporter.js  # CSV生成・ダウンロード
│   └── app.js          # メインアプリケーション
├── config.json         # 技術分野設定（表示アプリと共通）
├── 要件定義.md
└── README.md
```

### 2.2 データフロー
```
[ユーザー入力]
    ↓
[バリデーション (app.js)]
    ↓
[データ保存 (dataManager.js)]
    ↓
[localStorage (storage.js)]
    ↓
[一覧表示更新]

[エクスポート操作]
    ↓
[期間データ取得 (dataManager.js)]
    ↓
[CSV生成 (csvExporter.js)]
    ↓
[ファイルダウンロード]
```

## 3. 詳細設計

### 3.1 データ構造

#### localStorageキー
- `workTimeData`: 作業時間データ配列
- `lastCategory`: 最後に選択した技術分野
- `lastSubcategory`: 最後に選択した小分類

#### データオブジェクト
```javascript
{
  id: "uuid-v4",           // ユニークID
  date: "2024-10-28",      // 作業日（YYYY-MM-DD）
  category: "Linuxアプリ", // 技術分野（大分類）
  subcategory: "プロセス間通信", // 小分類
  hours: 5.5,              // 作業時間（数値）
  memo: "共有メモリ実装",   // メモ（文字列）
  createdAt: 1698480000000 // 作成日時（タイムスタンプ）
}
```

### 3.2 UI設計

#### レイアウト構成
```
┌─────────────────────────────────────┐
│  📝 技術別作業時間入力              │ ← ヘッダー
├─────────────────────────────────────┤
│  [入力フォーム]                     │
│  日付: [____] 技術分野: [▼]        │
│  小分類: [▼] 作業時間: [__]h       │
│  メモ: [_______________]            │
│  [追加] [クリア]                    │
├─────────────────────────────────────┤
│  📊 統計情報                        │
│  今週: 25.5h | 今月: 102.0h        │
├─────────────────────────────────────┤
│  💾 エクスポート                    │
│  [今週をエクスポート]              │
│  [今月をエクスポート]              │
│  [全データエクスポート]            │
├─────────────────────────────────────┤
│  📋 入力済みデータ (15件)          │
│  ┌───────────────────────────────┐ │
│  │ 2024-10-28 | Linuxアプリ     │ │
│  │ プロセス間通信 | 5.5h        │ │
│  │ 共有メモリ実装              │ │
│  │ [編集] [削除]               │ │
│  └───────────────────────────────┘ │
│  ┌───────────────────────────────┐ │
│  │ ...                           │ │
└─────────────────────────────────────┘
```

#### 入力フォーム
- **日付選択**: HTML5 `<input type="date">` (デフォルト: 今日)
- **技術分野**: `<select>` ドロップダウン（config.jsonから生成）
- **小分類**: 動的に更新される `<select>` 
- **作業時間**: `<input type="number" step="0.1">` (0.1単位)
- **メモ**: `<textarea>` (3行)

#### データ一覧
- カード形式で表示（日付降順）
- 編集ボタン: フォームにデータを読み込み
- 削除ボタン: 確認後に削除
- フィルタ機能: 週/月で絞り込み

### 3.3 JavaScript モジュール設計

#### config.js
```javascript
const Config = {
  async loadConfig() {
    // config.jsonを読み込み
    // フォールバック: デフォルト設定
  },
  getCategories() {
    // 技術分野一覧を取得
  },
  getSubcategories(category) {
    // 指定した技術分野の小分類を取得
  }
};
```

#### storage.js
```javascript
const Storage = {
  save(key, data) {
    // localStorageに保存（JSON形式）
  },
  load(key) {
    // localStorageから読み込み
  },
  remove(key) {
    // データ削除
  },
  clear() {
    // 全データ削除
  }
};
```

#### dataManager.js
```javascript
const DataManager = {
  data: [],
  
  init() {
    // localStorageからデータ読み込み
  },
  
  add(entry) {
    // 新規データ追加（UUIDを生成）
  },
  
  update(id, entry) {
    // データ更新
  },
  
  delete(id) {
    // データ削除
  },
  
  getAll() {
    // 全データ取得（日付降順）
  },
  
  getByDateRange(startDate, endDate) {
    // 期間指定でデータ取得
  },
  
  getThisWeek() {
    // 今週のデータ取得
  },
  
  getThisMonth() {
    // 今月のデータ取得
  },
  
  getStatistics() {
    // 統計情報（今週/今月の合計時間）
  }
};
```

#### csvExporter.js
```javascript
const CSVExporter = {
  generateCSV(data) {
    // データ配列からCSV文字列を生成
    // ヘッダー: 日付,技術分野,小分類,作業時間(h),メモ
  },
  
  download(csvContent, filename) {
    // Blob作成 → ダウンロードリンク生成 → クリック → 削除
  },
  
  exportWeek(weekNumber, year) {
    // 指定週のデータをエクスポート
    // ファイル名: week_YYYY_WW.csv
  },
  
  exportMonth(month, year) {
    // 指定月のデータをエクスポート
    // ファイル名: month_YYYY_MM.csv
  },
  
  exportAll() {
    // 全データをエクスポート
    // ファイル名: all_data_YYYY_MM_DD.csv
  }
};
```

#### app.js
```javascript
const App = {
  config: null,
  editingId: null,
  
  async init() {
    // 設定読み込み
    // データマネージャ初期化
    // イベントリスナー設定
    // 初期表示
  },
  
  setupEventListeners() {
    // フォーム送信
    // カテゴリ選択変更
    // エクスポートボタン
    // データ一覧の編集・削除
  },
  
  handleSubmit() {
    // バリデーション
    // データ保存
    // フォームクリア
    // 一覧更新
  },
  
  handleCategoryChange() {
    // 小分類ドロップダウンを更新
  },
  
  renderDataList() {
    // データ一覧をHTML生成して表示
  },
  
  editEntry(id) {
    // データをフォームに読み込み
  },
  
  deleteEntry(id) {
    // 確認後に削除
  },
  
  updateStatistics() {
    // 統計情報を更新表示
  },
  
  clearForm() {
    // フォームをクリア（日付は今日に戻す）
  },
  
  showNotification(message, type) {
    // 通知表示（成功/エラー）
  }
};
```

### 3.4 CSV生成ロジック

#### フォーマット
```csv
日付,技術分野,小分類,作業時間(h),メモ
2024-10-28,Linuxアプリ,プロセス間通信,5.5,共有メモリ実装
```

#### エスケープ処理
- カンマを含むフィールドはダブルクォートで囲む
- ダブルクォートは2つに重ねる（"" -> """"）
- 改行文字は保持

#### 週番号計算
```javascript
function getWeekNumber(date) {
  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const dayNum = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
  return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
}
```

## 4. UI/UXガイドライン

### 4.1 カラースキーム
- **プライマリ**: #667eea ~ #764ba2 (グラデーション)
- **成功**: #28a745 (保存成功)
- **エラー**: #dc3545 (バリデーションエラー)
- **背景**: #f8f9fa (リスト背景)

### 4.2 アニメーション
- データ追加時: スライドイン (0.3s)
- 削除時: フェードアウト (0.2s)
- 通知: フェードイン/アウト (0.3s)

### 4.3 レスポンシブブレークポイント
- **モバイル**: ~768px (1カラム、ボタン縦並び)
- **タブレット**: 769px~1024px (2カラム)
- **デスクトップ**: 1025px~ (3カラム可能)

## 5. バリデーションルール

### 5.1 必須項目
- 日付: 必須
- 技術分野: 必須
- 小分類: 必須
- 作業時間: 必須、0より大きい数値

### 5.2 任意項目
- メモ: 任意（空欄可）

### 5.3 エラーメッセージ
- 「日付を選択してください」
- 「技術分野を選択してください」
- 「小分類を選択してください」
- 「作業時間は0より大きい数値を入力してください」

## 6. 実装優先順位

### Phase 1: 基本機能（MVP）
1. ✅ 要件定義・設計書作成
2. HTML基本構造
3. CSS基本スタイル
4. config.js（設定読み込み）
5. storage.js（localStorage操作）
6. dataManager.js（CRUD基本機能）
7. app.js（フォーム入力・一覧表示）

### Phase 2: CSV機能
1. csvExporter.js（CSV生成）
2. ダウンロード機能
3. 週別・月別エクスポート

### Phase 3: UI改善
1. 統計情報表示
2. フィルタ機能
3. アニメーション
4. レスポンシブ対応

## 7. テスト項目

### 7.1 機能テスト
- [ ] データ追加（正常系）
- [ ] データ追加（バリデーションエラー）
- [ ] データ編集
- [ ] データ削除
- [ ] 週別CSVエクスポート
- [ ] 月別CSVエクスポート
- [ ] 全データエクスポート
- [ ] localStorage永続化

### 7.2 互換性テスト
- [ ] 出力CSVが表示アプリで正常に読み込める
- [ ] config.jsonが表示アプリと共有できる

### 7.3 ブラウザテスト
- [ ] Chrome
- [ ] Edge
- [ ] Firefox
- [ ] Safari (モバイル含む)

## 8. 表示アプリとの統合

### 8.1 config.json共有
- 同じ設定ファイルを両アプリで使用
- 技術分野の一貫性を保証

### 8.2 CSVフォーマット統一
- カラム順序: 日付,技術分野,小分類,作業時間(h),メモ
- 日付形式: YYYY-MM-DD
- 文字コード: UTF-8

### 8.3 推奨ワークフロー
1. **日次**: 入力アプリで作業記録
2. **週次**: 週末に週別CSVエクスポート
3. **月次**: 月末に月別CSVエクスポート
4. **分析**: 表示アプリでデータ可視化

## 9. 拡張可能性

### 将来的な機能追加候補
- CSVインポート機能（バックアップからの復元）
- データの自動バックアップ（Googleドライブ連携）
- テンプレート機能（定期作業の簡易入力）
- タイマー機能（作業時間の自動記録）
- 統計グラフのプレビュー
